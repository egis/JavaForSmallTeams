
<!DOCTYPE HTML>
<html lang="" >
    <head>
        <meta charset="UTF-8">
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <title>Prefer Immutable Objects Â· GitBook</title>
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta name="description" content="">
        <meta name="generator" content="GitBook 3.2.3">
        
        
        
    
    <link rel="stylesheet" href="../gitbook/style.css">

    
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-etoc/plugin.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-anchors/plugin.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-expandable-chapters/expandable-chapters.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-pygments/website.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-highlight/website.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-search/search.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-fontsettings/website.css">
                
            
        

    

    
        
    
        
    
        
    
        
    
        
    
        
    

        
    
    
    <meta name="HandheldFriendly" content="true"/>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <link rel="apple-touch-icon-precomposed" sizes="152x152" href="../gitbook/images/apple-touch-icon-precomposed-152.png">
    <link rel="shortcut icon" href="../gitbook/images/favicon.ico" type="image/x-icon">

    
    <link rel="next" href="051_optimise_for_readability_not_performance.html" />
    
    
    <link rel="prev" href="040_keep_your_code_dry.html" />
    

    </head>
    <body>
        
<div class="book">
    <div class="book-summary">
        
            
<div id="book-search-input" role="search">
    <input type="text" placeholder="Type to search" />
</div>

            
                <nav role="navigation">
                


<ul class="summary">
    
    

    

    
        
        
    
        <li class="chapter " data-level="1.1" data-path="../">
            
                <a href="../">
            
                    
                    Introduction
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2" data-path="../process.html">
            
                <a href="../process.html">
            
                    
                    Process
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.2.1" data-path="../process/100_build_fast_feedback_loops.html">
            
                <a href="../process/100_build_fast_feedback_loops.html">
            
                    
                    Build Fast Feedback Loops
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.2" data-path="../process/200_instant_feedback.html">
            
                <a href="../process/200_instant_feedback.html">
            
                    
                    Instant Feedback
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.3" data-path="../process/300_fast_feedback.html">
            
                <a href="../process/300_fast_feedback.html">
            
                    
                    Fast Feedback
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.4" data-path="../process/400_slower_feedback.html">
            
                <a href="../process/400_slower_feedback.html">
            
                    
                    Slower Feedback
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.5" data-path="../process/600_agree_the_language_you_use_for_tests.html">
            
                <a href="../process/600_agree_the_language_you_use_for_tests.html">
            
                    
                    Agree The Language You Use For Tests
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.6" data-path="../process/700_use_coverage_as_a_tool_not_a_target.html">
            
                <a href="../process/700_use_coverage_as_a_tool_not_a_target.html">
            
                    
                    Use Coverage As A Tool Not A Target
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.3" data-path="../style.html">
            
                <a href="../style.html">
            
                    
                    Style
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.3.1" data-path="001_remember_kiss_and_yagni.html">
            
                <a href="001_remember_kiss_and_yagni.html">
            
                    
                    Remember Kiss And Yagni
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.2" data-path="002_prefer_reversible_decisions.html">
            
                <a href="002_prefer_reversible_decisions.html">
            
                    
                    Prefer Reversible Decisions
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.3" data-path="010_use_a_consistent_code_layout.html">
            
                <a href="010_use_a_consistent_code_layout.html">
            
                    
                    Use A Consistent Code Layout
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.4" data-path="020_prefer_readable_code_to_comments.html">
            
                <a href="020_prefer_readable_code_to_comments.html">
            
                    
                    Prefer Readable Code To Comments
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.5" data-path="030_javadoc_judiciously.html">
            
                <a href="030_javadoc_judiciously.html">
            
                    
                    Javadoc Judiciously
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.6" data-path="040_keep_your_code_dry.html">
            
                <a href="040_keep_your_code_dry.html">
            
                    
                    Keep Your Code Dry
            
                </a>
            

            
        </li>
    
        <li class="chapter active" data-level="1.3.7" data-path="041_prefer_immutable_objects.html">
            
                <a href="041_prefer_immutable_objects.html">
            
                    
                    Prefer Immutable Objects
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.8" data-path="051_optimise_for_readability_not_performance.html">
            
                <a href="051_optimise_for_readability_not_performance.html">
            
                    
                    Optimise For Readability Not Performance
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.9" data-path="052_prefer_composition.html">
            
                <a href="052_prefer_composition.html">
            
                    
                    Prefer Composition
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.10" data-path="100_consider_code_generators_carefully.html">
            
                <a href="100_consider_code_generators_carefully.html">
            
                    
                    Consider Code Generators Carefully
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.11" data-path="200_group_methods_for_easy_comprehension.html">
            
                <a href="200_group_methods_for_easy_comprehension.html">
            
                    
                    Group Methods For Easy Comprehension
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.12" data-path="300_keep_methods_small_and_simple.html">
            
                <a href="300_keep_methods_small_and_simple.html">
            
                    
                    Keep Methods Small And Simple
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.13" data-path="400_methods_should_do_one_thing.html">
            
                <a href="400_methods_should_do_one_thing.html">
            
                    
                    Methods Should Do One Thing
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.14" data-path="600_avoid_null.html">
            
                <a href="600_avoid_null.html">
            
                    
                    Avoid Null
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.15" data-path="601_keep_it_solid.html">
            
                <a href="601_keep_it_solid.html">
            
                    
                    Keep It Solid
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.16" data-path="700_use_final_liberally.html">
            
                <a href="700_use_final_liberally.html">
            
                    
                    Use Final Liberally
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.17" data-path="800_provide_no_more_than_one_worker_constructor.html">
            
                <a href="800_provide_no_more_than_one_worker_constructor.html">
            
                    
                    Provide No More Than One Worker Constructor
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.18" data-path="900_avoid_checked_exceptions.html">
            
                <a href="900_avoid_checked_exceptions.html">
            
                    
                    Avoid Checked Exceptions
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.19" data-path="901_make_dependencies_explicit.html">
            
                <a href="901_make_dependencies_explicit.html">
            
                    
                    Make Dependencies Explicit
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.4" data-path="../specifics.html">
            
                <a href="../specifics.html">
            
                    
                    Specifics
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.4.1" data-path="../specifics/100_know_how_to_implement_hashcode_and_equals.html">
            
                <a href="../specifics/100_know_how_to_implement_hashcode_and_equals.html">
            
                    
                    Know How To Implement Hashcode And Equals
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.2" data-path="../specifics/200_do_not_reassign_parameters.html">
            
                <a href="../specifics/200_do_not_reassign_parameters.html">
            
                    
                    Do Not Reassign Parameters
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.3" data-path="../specifics/300_limit_scope.html">
            
                <a href="../specifics/300_limit_scope.html">
            
                    
                    Limit Scope
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.4" data-path="../specifics/400_prefer_for_each_loops_to_for_loops.html">
            
                <a href="../specifics/400_prefer_for_each_loops_to_for_loops.html">
            
                    
                    Prefer For Each Loops To For Loops
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.5" data-path="../specifics/500_prefer_maps_and_filters_to_imperative_loops.html">
            
                <a href="../specifics/500_prefer_maps_and_filters_to_imperative_loops.html">
            
                    
                    Prefer Maps And Filters To Imperative Loops
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.6" data-path="../specifics/600_avoid_apis_from_prehistory.html">
            
                <a href="../specifics/600_avoid_apis_from_prehistory.html">
            
                    
                    Avoid Apis From Prehistory
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.7" data-path="../specifics/700_beware_casts_and_generics_warnings.html">
            
                <a href="../specifics/700_beware_casts_and_generics_warnings.html">
            
                    
                    Beware Casts And Generics Warnings
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.8" data-path="../specifics/800_do_not_use_magic_numbers.html">
            
                <a href="../specifics/800_do_not_use_magic_numbers.html">
            
                    
                    Do Not Use Magic Numbers
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.9" data-path="../specifics/800_do_not_use_the_assert_keyword.html">
            
                <a href="../specifics/800_do_not_use_the_assert_keyword.html">
            
                    
                    Do Not Use The Assert Keyword
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.10" data-path="../specifics/900_avoid_floats_and_doubles.html">
            
                <a href="../specifics/900_avoid_floats_and_doubles.html">
            
                    
                    Avoid Floats And Doubles
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.11" data-path="../specifics/1000_do_not_use_reflection.html">
            
                <a href="../specifics/1000_do_not_use_reflection.html">
            
                    
                    Do Not Use Reflection
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.5" data-path="../tests.html">
            
                <a href="../tests.html">
            
                    
                    Tests
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.5.1" data-path="../tests/100_write_specifications_not_tests.html">
            
                <a href="../tests/100_write_specifications_not_tests.html">
            
                    
                    Write Specifications Not Tests
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.2" data-path="../tests/200_think_units_not_methods.html">
            
                <a href="../tests/200_think_units_not_methods.html">
            
                    
                    Think Units Not Methods
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.3" data-path="../tests/300_name_tests_with_a_specification_style.html">
            
                <a href="../tests/300_name_tests_with_a_specification_style.html">
            
                    
                    Name Tests With A Specification Style
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.4" data-path="../tests/400_pick_examples_carefully.html">
            
                <a href="../tests/400_pick_examples_carefully.html">
            
                    
                    Pick Examples Carefully
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.5" data-path="../tests/500_make_tests_easy_to_understand.html">
            
                <a href="../tests/500_make_tests_easy_to_understand.html">
            
                    
                    Make Tests Easy To Understand
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.6" data-path="../tests/600_understand_how_to_use_mocks_and_stubs.html">
            
                <a href="../tests/600_understand_how_to_use_mocks_and_stubs.html">
            
                    
                    Understand How To Use Mocks And Stubs
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.7" data-path="../tests/700_understand_your_options_for_code_reuse.html">
            
                <a href="../tests/700_understand_your_options_for_code_reuse.html">
            
                    
                    Understand Your Options For Code Reuse
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.8" data-path="../tests/750_write_repeatable_tests.html">
            
                <a href="../tests/750_write_repeatable_tests.html">
            
                    
                    Write Repeatable Tests
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.9" data-path="../tests/800_only_unit_test_code_it_makes_sense_to_unit_test.html">
            
                <a href="../tests/800_only_unit_test_code_it_makes_sense_to_unit_test.html">
            
                    
                    Only Unit Test Code It Makes Sense To Unit Test
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.10" data-path="../tests/900_testing_FAQS.html">
            
                <a href="../tests/900_testing_FAQS.html">
            
                    
                    Testing FAQS
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.6" data-path="../badadvice.html">
            
                <a href="../badadvice.html">
            
                    
                    Bad advice
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.6.1" data-path="../badadvice/010_use_getters_and_setters.html">
            
                <a href="../badadvice/010_use_getters_and_setters.html">
            
                    
                    Always use Getters and Setters
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.2" data-path="../badadvice/100_single_exit_point_rules.html">
            
                <a href="../badadvice/100_single_exit_point_rules.html">
            
                    
                    Single Exit Point Rules
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.3" data-path="../badadvice/200_always_use_a_StringBuffer.html">
            
                <a href="../badadvice/200_always_use_a_StringBuffer.html">
            
                    
                    Always Use A StringBuffer
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.4" data-path="../badadvice/300_hungarian_notation.html">
            
                <a href="../badadvice/300_hungarian_notation.html">
            
                    
                    Hungarian Notation
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

    

    <li class="divider"></li>

    <li>
        <a href="https://www.gitbook.com" target="blank" class="gitbook-link">
            Published with GitBook
        </a>
    </li>
</ul>


                </nav>
            
        
    </div>

    <div class="book-body">
        
            <div class="body-inner">
                
                    

<div class="book-header" role="navigation">
    

    <!-- Title -->
    <h1>
        <i class="fa fa-circle-o-notch fa-spin"></i>
        <a href=".." >Prefer Immutable Objects</a>
    </h1>
</div>




                    <div class="page-wrapper" tabindex="-1" role="main">
                        <div class="page-inner">
                            
<div id="book-search-results">
    <div class="search-noresults">
    
                                <section class="normal markdown-section">
                                
                                <h2 id="prefer-immutable-objects"><a name="prefer-immutable-objects" class="plugin-anchor" href="#prefer-immutable-objects"><i class="fa fa-link" aria-hidden="true"></i></a>Prefer Immutable Objects</h2>
<h3 id="summary"><a name="summary" class="plugin-anchor" href="#summary"><i class="fa fa-link" aria-hidden="true"></i></a>Summary</h3>
<p>Where possible, create objects that cannot be changed - especially if those objects will be long-lived or globally accessible.</p>
<h3 id="details"><a name="details" class="plugin-anchor" href="#details"><i class="fa fa-link" aria-hidden="true"></i></a>Details</h3>
<p>Mutable state makes programs harder to understand and maintain.</p>
<p>When objects are short-lived, and do not leave method scope, mutable state causes few problems. Writes and reads will be close together and there will be a clear order in which this happens.</p>
<p>For longer-lived objects, things are more complex.</p>
<p>If an object escapes from a method then it may be accessed from more than one location within the code.</p>
<p>We must start by assuming that anything that can happen to these objects will. We can only confirm that certain situations do not occur by examining the whole program.</p>
<p>The set of things that might happen to an immutable object is far smaller than for a mutable one. By constraining how long lived objects can behave we have made things simpler. There are fewer possibilities that we must consider.</p>
<p>Unfortunately, it is not always easy to tell from a class definition what the lifecycle of objects of that type will be. Perhaps only short-lived instances will be created. Perhaps only long-lived ones. Perhaps a mixture of the two.</p>
<p>If we design immutable classes by default we do not need to worry about this.</p>
<h4 id="the-problem-with-mutable-objects"><a name="the-problem-with-mutable-objects" class="plugin-anchor" href="#the-problem-with-mutable-objects"><i class="fa fa-link" aria-hidden="true"></i></a>The Problem With Mutable Objects</h4>
<p>If we have a very simple class such as <code>Foo</code></p>
<pre><code class="lang-java"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">Foo</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="n">Long</span> <span class="n">id</span><span class="o">;</span>

  <span class="kd">public</span> <span class="n">Long</span> <span class="nf">getId</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">return</span> <span class="n">id</span><span class="o">;</span>
  <span class="o">}</span>

  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setId</span><span class="o">(</span><span class="n">Long</span> <span class="n">id</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">this</span><span class="o">.</span><span class="na">id</span> <span class="o">=</span> <span class="n">id</span><span class="o">;</span>
  <span class="o">}</span>

  <span class="nd">@Override</span>
  <span class="kd">public</span> <span class="kt">int</span> <span class="nf">hashCode</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">return</span> <span class="n">Objects</span><span class="o">.</span><span class="na">hashCode</span><span class="o">(</span><span class="n">id</span><span class="o">);</span>
  <span class="o">}</span>

  <span class="nd">@Override</span>
  <span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">equals</span><span class="o">(</span><span class="n">Object</span> <span class="n">obj</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">if</span> <span class="o">(</span><span class="k">this</span> <span class="o">==</span> <span class="n">obj</span><span class="o">)</span>
      <span class="k">return</span> <span class="kc">true</span><span class="o">;</span>
    <span class="k">if</span> <span class="o">(</span><span class="n">obj</span> <span class="o">==</span> <span class="kc">null</span><span class="o">)</span>
      <span class="k">return</span> <span class="kc">false</span><span class="o">;</span>
    <span class="k">if</span> <span class="o">(</span><span class="n">getClass</span><span class="o">()</span> <span class="o">!=</span> <span class="n">obj</span><span class="o">.</span><span class="na">getClass</span><span class="o">())</span>
      <span class="k">return</span> <span class="kc">false</span><span class="o">;</span>
    <span class="n">Foo</span> <span class="n">other</span> <span class="o">=</span> <span class="o">(</span><span class="n">Foo</span><span class="o">)</span> <span class="n">obj</span><span class="o">;</span>
    <span class="k">return</span> <span class="n">Objects</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="n">id</span><span class="o">,</span> <span class="n">other</span><span class="o">.</span><span class="na">id</span><span class="o">);</span>
  <span class="o">}</span>
<span class="o">}</span>
</code></pre>
<p>We would need to search our codebase for all usages of it to establish the following :</p>
<h5 id="it-is-never-accessed-from-multiple-threads"><a name="it-is-never-accessed-from-multiple-threads" class="plugin-anchor" href="#it-is-never-accessed-from-multiple-threads"><i class="fa fa-link" aria-hidden="true"></i></a>It is Never Accessed from Multiple Threads</h5>
<p><code>Foo</code> is not thread safe.</p>
<p>Writes to longs are not atomic and nothing within <code>Foo</code> itself establishes a happens-before relationship between the field write and read.</p>
<p>If <code>setId</code> and <code>getId</code> are ever called from different threads we might get back stale or garbage values.</p>
<h5 id="setid-is-never-called-after-foo-has-been-placed-in-a-set"><a name="setid-is-never-called-after-foo-has-been-placed-in-a-set" class="plugin-anchor" href="#setid-is-never-called-after-foo-has-been-placed-in-a-set"><i class="fa fa-link" aria-hidden="true"></i></a><code>setId</code> Is Never Called After <code>Foo</code> Has Been Placed in a Set</h5>
<p>The <code>hashcode</code> of this class relies on a mutable field. If we modify it after we place it in a set then our program will not behave as we expect.</p>
<h5 id="the-flow-of-our-data"><a name="the-flow-of-our-data" class="plugin-anchor" href="#the-flow-of-our-data"><i class="fa fa-link" aria-hidden="true"></i></a>The Flow of Our Data</h5>
<p>Even if our program behaves correctly, we need to do work in order to understand how it functions.</p>
<p><code>setId</code> can be called at any point after the object is created. We can, therefore, only understand how data flows through our program by looking for all calls to <code>setId</code> - perhaps there are several, perhaps there is only one. The only way we can discover this is by examining the entire program.</p>
<h4 id="immutable-objects"><a name="immutable-objects" class="plugin-anchor" href="#immutable-objects"><i class="fa fa-link" aria-hidden="true"></i></a>Immutable Objects</h4>
<p>If we can make our objects immutable we gain guarantees that mean we do not need to worry about how our objects are used.</p>
<pre><code class="lang-java"><span class="nd">@Immutable</span>
<span class="kd">public</span> <span class="kd">final</span> <span class="kd">class</span> <span class="nc">Foo</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="kd">final</span> <span class="n">Long</span> <span class="n">id</span><span class="o">;</span>

  <span class="kd">public</span> <span class="nf">Foo</span><span class="o">(</span><span class="n">Long</span> <span class="n">id</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">this</span><span class="o">.</span><span class="na">id</span> <span class="o">=</span> <span class="n">id</span><span class="o">;</span>
  <span class="o">}</span>

  <span class="kd">public</span> <span class="n">Long</span> <span class="nf">getId</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">return</span> <span class="n">id</span><span class="o">;</span>
  <span class="o">}</span>

  <span class="nd">@Override</span>
  <span class="kd">public</span> <span class="kt">int</span> <span class="nf">hashCode</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">return</span> <span class="n">Objects</span><span class="o">.</span><span class="na">hashCode</span><span class="o">(</span><span class="n">id</span><span class="o">);</span>
  <span class="o">}</span>

  <span class="nd">@Override</span>
  <span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">equals</span><span class="o">(</span><span class="n">Object</span> <span class="n">obj</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">if</span> <span class="o">(</span><span class="k">this</span> <span class="o">==</span> <span class="n">obj</span><span class="o">)</span>
      <span class="k">return</span> <span class="kc">true</span><span class="o">;</span>
    <span class="k">if</span> <span class="o">(</span><span class="n">obj</span> <span class="o">==</span> <span class="kc">null</span><span class="o">)</span>
      <span class="k">return</span> <span class="kc">false</span><span class="o">;</span>
    <span class="k">if</span> <span class="o">(</span><span class="n">getClass</span><span class="o">()</span> <span class="o">!=</span> <span class="n">obj</span><span class="o">.</span><span class="na">getClass</span><span class="o">())</span>
      <span class="k">return</span> <span class="kc">false</span><span class="o">;</span>
    <span class="n">Foo</span> <span class="n">other</span> <span class="o">=</span> <span class="o">(</span><span class="n">Foo</span><span class="o">)</span> <span class="n">obj</span><span class="o">;</span>
    <span class="k">return</span> <span class="n">Objects</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="n">id</span><span class="o">,</span> <span class="n">other</span><span class="o">.</span><span class="na">id</span><span class="o">);</span>
  <span class="o">}</span>
<span class="o">}</span>
</code></pre>
<p>It no longer matters if <code>Foo</code> is long or short lived.</p>
<p>It is inherently thread-safe.</p>
<p>We know that whatever value we construct it with will remain until it dies. There is only one possible point where data is written so we do not need to search for others.</p>
<h5 id="annotations"><a name="annotations" class="plugin-anchor" href="#annotations"><i class="fa fa-link" aria-hidden="true"></i></a>Annotations</h5>
<p>The example uses the JSR3051 <code>javax.annotation.concurrent.Immutable</code> annotation.</p>
<p>This does not in any way change the object&apos;s functionality but provides a way to communicate the intent of this being an immutable class. Static analysis tools such as <a href="https://github.com/MutabilityDetector/MutabilityDetector" target="_blank">Mutablility Detector</a> can check if this intent has been violated.</p>
<p>We can tell at a glance that <code>Foo</code> is immutable as it has final fields of a well known immutable type.</p>
<p>The <code>final</code> keyword ensures only that the reference a field points to will not change.</p>
<p>If the field were of type <code>Bar</code> then we would not know if it were mutable or not without examining <code>Bar</code> to see if it too were immutable. Even if we were not using a static analysis tool the use of the <code>Immutable</code> annotation would make this assessment faster.</p>
<p>Instead of updating the state of immutable objects, we create new instances that retain the state we do not wish to modify.</p>
<p>This pattern seems strange to some Java programmers at first, but the programming model is similar to how the familiar <code>String</code> class works.</p>
<pre><code class="lang-java"><span class="nd">@Immutable</span>
<span class="kd">public</span> <span class="kd">final</span> <span class="kd">class</span> <span class="nc">Bar</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="kt">int</span> <span class="n">anInt</span><span class="o">;</span>
  <span class="kd">private</span> <span class="n">String</span> <span class="n">aString</span><span class="o">;</span>

  <span class="kd">public</span> <span class="nf">Bar</span><span class="o">(</span><span class="kt">int</span> <span class="n">anInt</span><span class="o">,</span> <span class="n">String</span> <span class="n">aString</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">this</span><span class="o">.</span><span class="na">anInt</span> <span class="o">=</span> <span class="n">anInt</span><span class="o">;</span>
    <span class="k">this</span><span class="o">.</span><span class="na">aString</span> <span class="o">=</span> <span class="n">aString</span><span class="o">;</span>
  <span class="o">}</span>


  <span class="nd">@CheckReturnValue</span>
  <span class="kd">public</span> <span class="n">Bar</span> <span class="nf">withAnInt</span><span class="o">(</span><span class="kt">int</span> <span class="n">anInt</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">return</span> <span class="k">new</span> <span class="n">Bar</span><span class="o">(</span><span class="n">anInt</span><span class="o">,</span> <span class="k">this</span><span class="o">.</span><span class="na">aString</span><span class="o">);</span>
  <span class="o">}</span>

  <span class="nd">@CheckReturnValue</span>
  <span class="kd">public</span> <span class="n">Bar</span> <span class="nf">withAString</span><span class="o">(</span><span class="n">String</span> <span class="n">aString</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">return</span> <span class="k">new</span> <span class="n">Bar</span><span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">antInt</span><span class="o">,</span> <span class="n">aString</span><span class="o">);</span>
  <span class="o">}</span>
<span class="o">}</span>
</code></pre>
<p>Instances of <code>Bar</code> with new values can be obtained by calling <code>withAString</code> and <code>withAnInt</code>.</p>
<p>The JSR305 <code>javax.annotation.CheckReturnValue</code> enables static analysis tools such as <a href="https://github.com/google/error-prone" target="_blank">Error Prone</a> to issue a warning if a mistake is made such as in the code below.</p>
<pre><code class="lang-java"><span class="kd">public</span> <span class="n">Bar</span> <span class="nf">doThings</span><span class="o">(</span><span class="n">Bar</span> <span class="n">bar</span><span class="o">)</span> <span class="o">{</span>
  <span class="k">if</span><span class="o">(</span><span class="n">someLogic</span><span class="o">())</span> <span class="o">{</span>
    <span class="n">bar</span><span class="o">.</span><span class="na">withAnInt</span><span class="o">(</span><span class="mi">42</span><span class="o">);</span>
  <span class="o">}</span>
  <span class="k">return</span> <span class="n">bar</span><span class="o">;</span>
<span class="o">}</span>
</code></pre>
<p>The call here to <code>withAnInt</code> achieves nothing because the return value is not stored. Most likely, the programmer intended to write:</p>
<pre><code class="lang-java"><span class="kd">public</span> <span class="n">Bar</span> <span class="nf">doThings</span><span class="o">(</span><span class="n">Bar</span> <span class="n">bar</span><span class="o">)</span> <span class="o">{</span>
  <span class="k">if</span><span class="o">(</span><span class="n">someLogic</span><span class="o">())</span> <span class="o">{</span>
    <span class="k">return</span> <span class="n">bar</span><span class="o">.</span><span class="na">withAnInt</span><span class="o">(</span><span class="mi">42</span><span class="o">);</span>
  <span class="o">}</span>
  <span class="k">return</span> <span class="n">bar</span><span class="o">;</span>
<span class="o">}</span>
</code></pre>
<h4 id="when-to-use-mutable-objects"><a name="when-to-use-mutable-objects" class="plugin-anchor" href="#when-to-use-mutable-objects"><i class="fa fa-link" aria-hidden="true"></i></a>When to Use Mutable Objects</h4>
<p>Mutable objects require slightly less boilerplate to create than immutable ones.</p>
<p>If you know that a class will only ever be used to create short-lived, local objects then you might consider making it mutable. But you must weigh this against the additional work required to ensure that the class is only ever used in this fashion as the codebase grows.</p>
<p>Options exist to auto-generate both immutable and mutable classes, thereby removing mutable objects&apos; main advantage. Two of these options are discussed further in &quot;Know How to Implement Hashcode and Equals&quot;.</p>
<p>Mutable objects used to be the norm in Java. As a result, many common frameworks require mutable objects. Persistence and serialization frameworks often require Java beans with no args constructors and setters. Other frameworks might require you to use two-stage construction with a lifecycle method such as init.</p>
<p>It is not always highlighted in the documentation but some long standing frameworks have been updated to support immutable objects.</p>
<p>Jackson for example now allows constructors and factory methods to be annotated :-</p>
<pre><code class="lang-java"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">Foo</span>  <span class="o">{</span>
  <span class="kd">private</span> <span class="kd">final</span> <span class="kt">int</span> <span class="n">x</span>
  <span class="kd">private</span> <span class="kd">final</span> <span class="kt">int</span> <span class="n">y</span><span class="o">;</span>

  <span class="nd">@JsonCreator</span>
  <span class="kd">public</span> <span class="nf">Foo</span><span class="o">(</span><span class="nd">@JsonProperty</span><span class="o">(</span><span class="s">&quot;x&quot;</span><span class="o">)</span> <span class="kt">int</span> <span class="n">x</span><span class="o">,</span> <span class="nd">@JsonProperty</span><span class="o">(</span><span class="s">&quot;y&quot;</span><span class="o">)</span> <span class="kt">int</span> <span class="n">y</span><span class="o">)</span> <span class="o">{</span>
   <span class="k">this</span><span class="o">.</span><span class="na">x</span> <span class="o">=</span> <span class="n">x</span><span class="o">;</span>
   <span class="k">this</span><span class="o">.</span><span class="na">y</span> <span class="o">=</span> <span class="n">y</span><span class="o">;</span>
  <span class="o">}</span>
<span class="o">}</span>
</code></pre>
<p>Other frameworks, such as Hibernate, can only be used with classes that provide a default constructor. Although they can be configured to set fields directly without the need for setters this causes more problems than it solves.</p>
<p>If you are tied to a framework that requires mutability then you will need to use mutable objects where you interface with that framework.</p>

                                
                                </section>
                            
    </div>
    <div class="search-results">
        <div class="has-results">
            
            <h1 class="search-results-title"><span class='search-results-count'></span> results matching "<span class='search-query'></span>"</h1>
            <ul class="search-results-list"></ul>
            
        </div>
        <div class="no-results">
            
            <h1 class="search-results-title">No results matching "<span class='search-query'></span>"</h1>
            
        </div>
    </div>
</div>

                        </div>
                    </div>
                
            </div>

            
                
                <a href="040_keep_your_code_dry.html" class="navigation navigation-prev " aria-label="Previous page: Keep Your Code Dry">
                    <i class="fa fa-angle-left"></i>
                </a>
                
                
                <a href="051_optimise_for_readability_not_performance.html" class="navigation navigation-next " aria-label="Next page: Optimise For Readability Not Performance">
                    <i class="fa fa-angle-right"></i>
                </a>
                
            
        
    </div>

    <script>
        var gitbook = gitbook || [];
        gitbook.push(function() {
            gitbook.page.hasChanged({"page":{"title":"Prefer Immutable Objects","level":"1.3.7","depth":2,"next":{"title":"Optimise For Readability Not Performance","level":"1.3.8","depth":2,"path":"style/051_optimise_for_readability_not_performance.md","ref":"style/051_optimise_for_readability_not_performance.md","articles":[]},"previous":{"title":"Keep Your Code Dry","level":"1.3.6","depth":2,"path":"style/040_keep_your_code_dry.md","ref":"style/040_keep_your_code_dry.md","articles":[]},"dir":"ltr"},"config":{"gitbook":"*","theme":"default","variables":{},"plugins":["edit-link","etoc","anchors","expandable-chapters","pygments"],"pluginsConfig":{"etoc":{"mindepth":3,"maxdepth":4,"header":1,"h2lb":3,"notoc":false},"search":{},"lunr":{"maxIndexSize":1000000,"ignoreSpecialCharacters":false},"fontsettings":{"theme":"white","family":"sans","size":2},"highlight":{},"pygments":{},"sharing":{"facebook":true,"twitter":true,"google":false,"weibo":false,"instapaper":false,"vk":false,"all":["facebook","google","twitter","weibo","instapaper"]},"edit-link":{"label":"Edit This Page","base":"https://github.com/egis/JavaForSmallTeams/blob/master/"},"theme-default":{"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"},"showLevel":false},"anchors":{},"expandable-chapters":{}},"structure":{"langs":"LANGS.md","readme":"README.md","glossary":"GLOSSARY.md","summary":"SUMMARY.md"},"pdf":{"pageNumbers":true,"fontSize":12,"fontFamily":"Arial","paperSize":"a4","chapterMark":"pagebreak","pageBreaksBefore":"/","margin":{"right":62,"left":62,"top":56,"bottom":56}},"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"}},"file":{"path":"style/041_prefer_immutable_objects.md","mtime":"2017-08-31T18:27:40.758Z","type":"markdown"},"gitbook":{"version":"3.2.3","time":"2017-08-31T18:29:32.744Z"},"basePath":"..","book":{"language":""}});
        });
    </script>
</div>

        
    <script src="../gitbook/gitbook.js"></script>
    <script src="../gitbook/theme.js"></script>
    
        
        <script src="../gitbook/gitbook-plugin-edit-link/plugin.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-etoc/plugin.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-expandable-chapters/expandable-chapters.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-search/search-engine.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-search/search.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-lunr/lunr.min.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-lunr/search-lunr.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-sharing/buttons.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-fontsettings/fontsettings.js"></script>
        
    

    </body>
</html>

