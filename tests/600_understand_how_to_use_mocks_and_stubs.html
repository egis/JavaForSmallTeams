
<!DOCTYPE HTML>
<html lang="" >
    <head>
        <meta charset="UTF-8">
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <title>Understand How To Use Mocks And Stubs Â· GitBook</title>
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta name="description" content="">
        <meta name="generator" content="GitBook 3.2.3">
        
        
        
    
    <link rel="stylesheet" href="../gitbook/style.css">

    
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-etoc/plugin.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-anchors/plugin.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-expandable-chapters/expandable-chapters.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-pygments/website.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-highlight/website.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-search/search.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-fontsettings/website.css">
                
            
        

    

    
        
    
        
    
        
    
        
    
        
    
        
    

        
    
    
    <meta name="HandheldFriendly" content="true"/>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <link rel="apple-touch-icon-precomposed" sizes="152x152" href="../gitbook/images/apple-touch-icon-precomposed-152.png">
    <link rel="shortcut icon" href="../gitbook/images/favicon.ico" type="image/x-icon">

    
    <link rel="next" href="700_understand_your_options_for_code_reuse.html" />
    
    
    <link rel="prev" href="500_make_tests_easy_to_understand.html" />
    

    </head>
    <body>
        
<div class="book">
    <div class="book-summary">
        
            
<div id="book-search-input" role="search">
    <input type="text" placeholder="Type to search" />
</div>

            
                <nav role="navigation">
                


<ul class="summary">
    
    

    

    
        
        
    
        <li class="chapter " data-level="1.1" data-path="../">
            
                <a href="../">
            
                    
                    Introduction
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2" data-path="../process.html">
            
                <a href="../process.html">
            
                    
                    Process
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.2.1" data-path="../process/100_build_fast_feedback_loops.html">
            
                <a href="../process/100_build_fast_feedback_loops.html">
            
                    
                    Build Fast Feedback Loops
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.2" data-path="../process/200_instant_feedback.html">
            
                <a href="../process/200_instant_feedback.html">
            
                    
                    Instant Feedback
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.3" data-path="../process/300_fast_feedback.html">
            
                <a href="../process/300_fast_feedback.html">
            
                    
                    Fast Feedback
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.4" data-path="../process/400_slower_feedback.html">
            
                <a href="../process/400_slower_feedback.html">
            
                    
                    Slower Feedback
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.5" data-path="../process/600_agree_the_language_you_use_for_tests.html">
            
                <a href="../process/600_agree_the_language_you_use_for_tests.html">
            
                    
                    Agree The Language You Use For Tests
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.6" data-path="../process/700_use_coverage_as_a_tool_not_a_target.html">
            
                <a href="../process/700_use_coverage_as_a_tool_not_a_target.html">
            
                    
                    Use Coverage As A Tool Not A Target
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.3" data-path="../style.html">
            
                <a href="../style.html">
            
                    
                    Style
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.3.1" data-path="../style/001_remember_kiss_and_yagni.html">
            
                <a href="../style/001_remember_kiss_and_yagni.html">
            
                    
                    Remember Kiss And Yagni
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.2" data-path="../style/002_prefer_reversible_decisions.html">
            
                <a href="../style/002_prefer_reversible_decisions.html">
            
                    
                    Prefer Reversible Decisions
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.3" data-path="../style/010_use_a_consistent_code_layout.html">
            
                <a href="../style/010_use_a_consistent_code_layout.html">
            
                    
                    Use A Consistent Code Layout
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.4" data-path="../style/020_prefer_readable_code_to_comments.html">
            
                <a href="../style/020_prefer_readable_code_to_comments.html">
            
                    
                    Prefer Readable Code To Comments
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.5" data-path="../style/030_javadoc_judiciously.html">
            
                <a href="../style/030_javadoc_judiciously.html">
            
                    
                    Javadoc Judiciously
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.6" data-path="../style/040_keep_your_code_dry.html">
            
                <a href="../style/040_keep_your_code_dry.html">
            
                    
                    Keep Your Code Dry
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.7" data-path="../style/041_prefer_immutable_objects.html">
            
                <a href="../style/041_prefer_immutable_objects.html">
            
                    
                    Prefer Immutable Objects
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.8" data-path="../style/051_optimise_for_readability_not_performance.html">
            
                <a href="../style/051_optimise_for_readability_not_performance.html">
            
                    
                    Optimise For Readability Not Performance
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.9" data-path="../style/052_prefer_composition.html">
            
                <a href="../style/052_prefer_composition.html">
            
                    
                    Prefer Composition
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.10" data-path="../style/100_consider_code_generators_carefully.html">
            
                <a href="../style/100_consider_code_generators_carefully.html">
            
                    
                    Consider Code Generators Carefully
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.11" data-path="../style/200_group_methods_for_easy_comprehension.html">
            
                <a href="../style/200_group_methods_for_easy_comprehension.html">
            
                    
                    Group Methods For Easy Comprehension
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.12" data-path="../style/300_keep_methods_small_and_simple.html">
            
                <a href="../style/300_keep_methods_small_and_simple.html">
            
                    
                    Keep Methods Small And Simple
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.13" data-path="../style/400_methods_should_do_one_thing.html">
            
                <a href="../style/400_methods_should_do_one_thing.html">
            
                    
                    Methods Should Do One Thing
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.14" data-path="../style/600_avoid_null.html">
            
                <a href="../style/600_avoid_null.html">
            
                    
                    Avoid Null
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.15" data-path="../style/601_keep_it_solid.html">
            
                <a href="../style/601_keep_it_solid.html">
            
                    
                    Keep It Solid
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.16" data-path="../style/700_use_final_liberally.html">
            
                <a href="../style/700_use_final_liberally.html">
            
                    
                    Use Final Liberally
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.17" data-path="../style/800_provide_no_more_than_one_worker_constructor.html">
            
                <a href="../style/800_provide_no_more_than_one_worker_constructor.html">
            
                    
                    Provide No More Than One Worker Constructor
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.18" data-path="../style/900_avoid_checked_exceptions.html">
            
                <a href="../style/900_avoid_checked_exceptions.html">
            
                    
                    Avoid Checked Exceptions
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.19" data-path="../style/901_make_dependencies_explicit.html">
            
                <a href="../style/901_make_dependencies_explicit.html">
            
                    
                    Make Dependencies Explicit
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.4" data-path="../specifics.html">
            
                <a href="../specifics.html">
            
                    
                    Specifics
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.4.1" data-path="../specifics/100_know_how_to_implement_hashcode_and_equals.html">
            
                <a href="../specifics/100_know_how_to_implement_hashcode_and_equals.html">
            
                    
                    Know How To Implement Hashcode And Equals
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.2" data-path="../specifics/200_do_not_reassign_parameters.html">
            
                <a href="../specifics/200_do_not_reassign_parameters.html">
            
                    
                    Do Not Reassign Parameters
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.3" data-path="../specifics/300_limit_scope.html">
            
                <a href="../specifics/300_limit_scope.html">
            
                    
                    Limit Scope
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.4" data-path="../specifics/400_prefer_for_each_loops_to_for_loops.html">
            
                <a href="../specifics/400_prefer_for_each_loops_to_for_loops.html">
            
                    
                    Prefer For Each Loops To For Loops
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.5" data-path="../specifics/500_prefer_maps_and_filters_to_imperative_loops.html">
            
                <a href="../specifics/500_prefer_maps_and_filters_to_imperative_loops.html">
            
                    
                    Prefer Maps And Filters To Imperative Loops
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.6" data-path="../specifics/600_avoid_apis_from_prehistory.html">
            
                <a href="../specifics/600_avoid_apis_from_prehistory.html">
            
                    
                    Avoid Apis From Prehistory
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.7" data-path="../specifics/700_beware_casts_and_generics_warnings.html">
            
                <a href="../specifics/700_beware_casts_and_generics_warnings.html">
            
                    
                    Beware Casts And Generics Warnings
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.8" data-path="../specifics/800_do_not_use_magic_numbers.html">
            
                <a href="../specifics/800_do_not_use_magic_numbers.html">
            
                    
                    Do Not Use Magic Numbers
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.9" data-path="../specifics/800_do_not_use_the_assert_keyword.html">
            
                <a href="../specifics/800_do_not_use_the_assert_keyword.html">
            
                    
                    Do Not Use The Assert Keyword
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.10" data-path="../specifics/900_avoid_floats_and_doubles.html">
            
                <a href="../specifics/900_avoid_floats_and_doubles.html">
            
                    
                    Avoid Floats And Doubles
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.11" data-path="../specifics/1000_do_not_use_reflection.html">
            
                <a href="../specifics/1000_do_not_use_reflection.html">
            
                    
                    Do Not Use Reflection
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.5" data-path="../tests.html">
            
                <a href="../tests.html">
            
                    
                    Tests
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.5.1" data-path="100_write_specifications_not_tests.html">
            
                <a href="100_write_specifications_not_tests.html">
            
                    
                    Write Specifications Not Tests
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.2" data-path="200_think_units_not_methods.html">
            
                <a href="200_think_units_not_methods.html">
            
                    
                    Think Units Not Methods
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.3" data-path="300_name_tests_with_a_specification_style.html">
            
                <a href="300_name_tests_with_a_specification_style.html">
            
                    
                    Name Tests With A Specification Style
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.4" data-path="400_pick_examples_carefully.html">
            
                <a href="400_pick_examples_carefully.html">
            
                    
                    Pick Examples Carefully
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.5" data-path="500_make_tests_easy_to_understand.html">
            
                <a href="500_make_tests_easy_to_understand.html">
            
                    
                    Make Tests Easy To Understand
            
                </a>
            

            
        </li>
    
        <li class="chapter active" data-level="1.5.6" data-path="600_understand_how_to_use_mocks_and_stubs.html">
            
                <a href="600_understand_how_to_use_mocks_and_stubs.html">
            
                    
                    Understand How To Use Mocks And Stubs
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.7" data-path="700_understand_your_options_for_code_reuse.html">
            
                <a href="700_understand_your_options_for_code_reuse.html">
            
                    
                    Understand Your Options For Code Reuse
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.8" data-path="750_write_repeatable_tests.html">
            
                <a href="750_write_repeatable_tests.html">
            
                    
                    Write Repeatable Tests
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.9" data-path="800_only_unit_test_code_it_makes_sense_to_unit_test.html">
            
                <a href="800_only_unit_test_code_it_makes_sense_to_unit_test.html">
            
                    
                    Only Unit Test Code It Makes Sense To Unit Test
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.10" data-path="900_testing_FAQS.html">
            
                <a href="900_testing_FAQS.html">
            
                    
                    Testing FAQS
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.6" data-path="../badadvice.html">
            
                <a href="../badadvice.html">
            
                    
                    Bad advice
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.6.1" data-path="../badadvice/010_use_getters_and_setters.html">
            
                <a href="../badadvice/010_use_getters_and_setters.html">
            
                    
                    Always use Getters and Setters
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.2" data-path="../badadvice/100_single_exit_point_rules.html">
            
                <a href="../badadvice/100_single_exit_point_rules.html">
            
                    
                    Single Exit Point Rules
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.3" data-path="../badadvice/200_always_use_a_StringBuffer.html">
            
                <a href="../badadvice/200_always_use_a_StringBuffer.html">
            
                    
                    Always Use A StringBuffer
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.4" data-path="../badadvice/300_hungarian_notation.html">
            
                <a href="../badadvice/300_hungarian_notation.html">
            
                    
                    Hungarian Notation
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

    

    <li class="divider"></li>

    <li>
        <a href="https://www.gitbook.com" target="blank" class="gitbook-link">
            Published with GitBook
        </a>
    </li>
</ul>


                </nav>
            
        
    </div>

    <div class="book-body">
        
            <div class="body-inner">
                
                    

<div class="book-header" role="navigation">
    

    <!-- Title -->
    <h1>
        <i class="fa fa-circle-o-notch fa-spin"></i>
        <a href=".." >Understand How To Use Mocks And Stubs</a>
    </h1>
</div>




                    <div class="page-wrapper" tabindex="-1" role="main">
                        <div class="page-inner">
                            
<div id="book-search-results">
    <div class="search-noresults">
    
                                <section class="normal markdown-section">
                                
                                <h2 id="understand-how-to-use-mocks-and-stubs"><a name="understand-how-to-use-mocks-and-stubs" class="plugin-anchor" href="#understand-how-to-use-mocks-and-stubs"><i class="fa fa-link" aria-hidden="true"></i></a>Understand How to Use Mocks and Stubs</h2>
<p>There are two sorts of code and they require two different sorts of test.</p>
<p><strong>Worker code</strong> does stuff. We can test worker code with <strong>state based testing</strong> - i.e. asserting that expected values are returned from methods, or objects are left in expected states.</p>
<p>State based testing is easily recognized as it will use assert statements.</p>
<p><strong>Manager code</strong> does stuff by co-coordinating others.</p>
<p>Manager code is harder to test than worker code because we need to make a choice - do we try to infer its behavior from its outputs using state based testing, or do we use <strong>interaction based testing</strong>?</p>
<p>In interaction based testing, we check that objects talk to each other in the expected fashion. To do this we need to somehow eavesdrop on the conversation. This is achieved by using objects that impersonate real ones.</p>
<p>Usually these are created using a mocking framework.</p>
<h3 id="mocking-frameworks"><a name="mocking-frameworks" class="plugin-anchor" href="#mocking-frameworks"><i class="fa fa-link" aria-hidden="true"></i></a>Mocking Frameworks</h3>
<p>Although it is common to refer to all objects created by a mocking framework as mocks this is inaccurate.</p>
<p>A more correct generic term for these objects is <em>test double</em>.</p>
<p>These can be subdivided based on how they behave:</p>
<ul>
<li>Dummy object - needs to be present to satisfy a type signature but is never actually used</li>
<li>Stub - must be present and may supply <em>indirect inputs</em></li>
<li>Mock - verifies that expected interactions take place</li>
<li>Fake - like a real thing but less heavy - e.g an in memory database</li>
<li>Spy  - object that records its interactions with others</li>
</ul>
<p>Of these only stubs, mocks and spies might be created by a mocking framework.</p>
<p>We will talk about spies in a moment, but most test doubles can be conceptually viewed as being either a stub or a mock.</p>
<p>The important difference between them is that a mock has an expectation that will cause a test to fail if it is not met. i.e. if an expected method is not called on a mock the test will fail.</p>
<p>A stub does not care if it is called or not - its role is simply to supply values.</p>
<p>Traditional Mocks present a code readability dilemma. They define an expected outcome (a <em>then</em>), but are also part of the fixture required for the test to execute (a <em>given</em>).</p>
<p>For example with JMock we would write:</p>
<pre><code class="lang-java">  <span class="n">Mockery</span> <span class="n">context</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Mockery</span><span class="o">();</span>

  <span class="c1">// given / arrange</span>
  <span class="n">Subscriber</span> <span class="n">subscriber</span> <span class="o">=</span> <span class="n">context</span><span class="o">.</span><span class="na">mock</span><span class="o">(</span><span class="n">Subscriber</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
  <span class="n">Publisher</span> <span class="n">publisher</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Publisher</span><span class="o">();</span>
  <span class="n">publisher</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">subscriber</span><span class="o">);</span>

  <span class="kd">final</span> <span class="n">String</span> <span class="n">message</span> <span class="o">=</span> <span class="s">&quot;message&quot;</span><span class="o">;</span>

  <span class="c1">// then / assert . . . but we haven&apos;t had a when yet</span>
  <span class="n">context</span><span class="o">.</span><span class="na">checking</span><span class="o">(</span><span class="k">new</span> <span class="n">Expectations</span><span class="o">()</span> <span class="o">{{</span>
    <span class="n">oneOf</span> <span class="o">(</span><span class="n">subscriber</span><span class="o">).</span><span class="na">receive</span><span class="o">(</span><span class="n">message</span><span class="o">);</span>
  <span class="o">}});</span>

  <span class="c1">// when / act</span>
  <span class="n">publisher</span><span class="o">.</span><span class="na">publish</span><span class="o">(</span><span class="n">message</span><span class="o">);</span>

  <span class="c1">// then / assert</span>
  <span class="n">context</span><span class="o">.</span><span class="na">assertIsSatisfied</span><span class="o">();</span>
</code></pre>
<p>Spies solve this problem neatly.</p>
<h3 id="spies"><a name="spies" class="plugin-anchor" href="#spies"><i class="fa fa-link" aria-hidden="true"></i></a>Spies</h3>
<p>Spies record their interactions with other objects.</p>
<p>In practice this means that Spies act as stubs by default, but as mocks when we want them to.</p>
<p>The given/when/then flow becomes easy and natural to maintain.</p>
<p>For example, using Mockito:</p>
<pre><code class="lang-java">  <span class="c1">// given</span>
  <span class="n">Subscriber</span> <span class="n">subscriber</span> <span class="o">=</span> <span class="n">Mockito</span><span class="o">.</span><span class="na">mock</span><span class="o">(</span><span class="n">Subscriber</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
  <span class="n">Publisher</span> <span class="n">publisher</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Publisher</span><span class="o">();</span>
  <span class="n">publisher</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">subscriber</span><span class="o">);</span>
  <span class="n">String</span> <span class="n">message</span> <span class="o">=</span> <span class="s">&quot;message&quot;</span><span class="o">;</span>

  <span class="c1">// when</span>
  <span class="n">publisher</span><span class="o">.</span><span class="na">publish</span><span class="o">(</span><span class="n">message</span><span class="o">);</span>

  <span class="c1">// then</span>
  <span class="n">Mockito</span><span class="o">.</span><span class="na">verify</span><span class="o">(</span><span class="n">subscriber</span><span class="o">).</span><span class="na">receive</span><span class="o">(</span><span class="n">message</span><span class="o">);</span>
</code></pre>
<p>For this reason we recommend using a spy framework.</p>
<p>When spies act as mocks that must also supply indirect inputs, it is best to make them as forgiving as possible when supplying values but as specific as possible when verifying.</p>
<p>What does this mean?</p>
<p>Lets imagine that, for some reason, the subscribers in our example had to return a positive integer in order for the code to execute without error. Perhaps there is some sort of assert statement in the code:</p>
<pre><code class="lang-java"><span class="kd">public</span> <span class="kd">interface</span> <span class="nc">Subscriber</span> <span class="o">{</span>
  <span class="kt">int</span> <span class="nf">receive</span><span class="o">(</span><span class="n">String</span> <span class="n">message</span><span class="o">);</span>
<span class="o">}</span>
</code></pre>
<p>We could ensure our test passed as follows:</p>
<pre><code class="lang-java">  <span class="n">String</span> <span class="n">message</span> <span class="o">=</span> <span class="s">&quot;amessage&quot;</span><span class="o">;</span>
  <span class="n">Subscriber</span> <span class="n">subscriber</span> <span class="o">=</span> <span class="n">Mockito</span><span class="o">.</span><span class="na">mock</span><span class="o">(</span><span class="n">Subscriber</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
  <span class="c1">// inject indirect value</span>
  <span class="n">Mockito</span><span class="o">.</span><span class="na">when</span><span class="o">(</span><span class="n">subscriber</span><span class="o">.</span><span class="na">receive</span><span class="o">(</span><span class="n">message</span><span class="o">)).</span><span class="na">thenReturn</span><span class="o">(</span><span class="mi">1</span><span class="o">);</span>

  <span class="n">Publisher</span> <span class="n">publisher</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Publisher</span><span class="o">();</span>
  <span class="n">publisher</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">subscriber</span><span class="o">);</span>

  <span class="n">publisher</span><span class="o">.</span><span class="na">publish</span><span class="o">(</span><span class="n">message</span><span class="o">);</span>

  <span class="n">Mockito</span><span class="o">.</span><span class="na">verify</span><span class="o">(</span><span class="n">subscriber</span><span class="o">).</span><span class="na">receive</span><span class="o">(</span><span class="n">message</span><span class="o">);</span>
</code></pre>
<p>We will not discuss the Mockito API in any detail here, but this line:</p>
<pre><code class="lang-java">  <span class="n">Mockito</span><span class="o">.</span><span class="na">when</span><span class="o">(</span><span class="n">subscriber</span><span class="o">.</span><span class="na">receive</span><span class="o">(</span><span class="n">message</span><span class="o">)).</span><span class="na">thenReturn</span><span class="o">(</span><span class="mi">1</span><span class="o">);</span>
</code></pre>
<p>Ensures that when the <code>receive</code> method is called on the spy with a string that equals the <code>message</code> variable, it will return <code>1</code>.</p>
<p>If this line was not present the spy would do what Mockito does by default, which is to return <code>0</code>.</p>
<p>What would our test do if, due to a bug, <code>receive</code> was called with a different string?</p>
<p>The answer is that, instead of failing due to the verification:</p>
<pre><code class="lang-java">    <span class="n">Mockito</span><span class="o">.</span><span class="na">verify</span><span class="o">(</span><span class="n">subscriber</span><span class="o">).</span><span class="na">receive</span><span class="o">(</span><span class="n">message</span><span class="o">);</span>
</code></pre>
<p>It would throw an error before it reached this point because the assertion in our production code would trigger.</p>
<p>We were too specific.</p>
<p>If we instead setup our spy as follows</p>
<pre><code class="lang-java">    <span class="n">Mockito</span><span class="o">.</span><span class="na">when</span><span class="o">(</span><span class="n">subscriber</span><span class="o">.</span><span class="na">receive</span><span class="o">(</span><span class="n">anyString</span><span class="o">())).</span><span class="na">thenReturn</span><span class="o">(</span><span class="mi">1</span><span class="o">);</span>
</code></pre>
<p>The test would fail cleanly.</p>
<p>This pattern of being lenient when supplying values, but specific when verifying also tends to result in tests that are less brittle when things change.</p>
<h3 id="stubs-in-state-based-tests"><a name="stubs-in-state-based-tests" class="plugin-anchor" href="#stubs-in-state-based-tests"><i class="fa fa-link" aria-hidden="true"></i></a>Stubs in State-Based Tests</h3>
<p>By definition, state-based testing will never include mocks (in the strict sense of the word), but they may use stubs to supply indirect values.</p>
<p>It can be tempting to also use a mocking framework to stub values instead of using their constructors and modifier methods. For complex objects using stubs can appear easier than constructing real ones.</p>
<p>Don&apos;t do this.</p>
<p>Mocking frameworks should be used only to isolate our tests from objects with behavior. If you have values that are difficult to construct consider the test data builder pattern instead</p>
<h3 id="choosing-between-state-and-interaction-testing"><a name="choosing-between-state-and-interaction-testing" class="plugin-anchor" href="#choosing-between-state-and-interaction-testing"><i class="fa fa-link" aria-hidden="true"></i></a>Choosing Between State and Interaction Testing</h3>
<p>Sometimes there is no choice about which to use. For example, it is not possible to meaningfully specify how a cache should behave from its inputs and outputs alone. Other times we must weigh the pros and cons.</p>
<p>A state-based test for manager code is likely to be less easy to read and understand as it must rely on the behaviors of the objects the SUT interacts with. The test will also be coupled to these behaviors and will require changes if those behaviors change - you have effectively increased the size of the &quot;unit&quot; you are testing as discussed in &quot;Think units not methods&quot;.</p>
<p>Interaction-based testing requires us to peek beyond the unit&apos;s external interface and into its implementation. This carries the risk that we might over-specify and create an implementation-specific test.</p>
<p>On balance, it is preferable to lean towards state based testing and where possible enable it in the design of your code. There will, however, be many situations in which you will decide that interaction based testing is preferable.</p>

                                
                                </section>
                            
    </div>
    <div class="search-results">
        <div class="has-results">
            
            <h1 class="search-results-title"><span class='search-results-count'></span> results matching "<span class='search-query'></span>"</h1>
            <ul class="search-results-list"></ul>
            
        </div>
        <div class="no-results">
            
            <h1 class="search-results-title">No results matching "<span class='search-query'></span>"</h1>
            
        </div>
    </div>
</div>

                        </div>
                    </div>
                
            </div>

            
                
                <a href="500_make_tests_easy_to_understand.html" class="navigation navigation-prev " aria-label="Previous page: Make Tests Easy To Understand">
                    <i class="fa fa-angle-left"></i>
                </a>
                
                
                <a href="700_understand_your_options_for_code_reuse.html" class="navigation navigation-next " aria-label="Next page: Understand Your Options For Code Reuse">
                    <i class="fa fa-angle-right"></i>
                </a>
                
            
        
    </div>

    <script>
        var gitbook = gitbook || [];
        gitbook.push(function() {
            gitbook.page.hasChanged({"page":{"title":"Understand How To Use Mocks And Stubs","level":"1.5.6","depth":2,"next":{"title":"Understand Your Options For Code Reuse","level":"1.5.7","depth":2,"path":"tests/700_understand_your_options_for_code_reuse.md","ref":"tests/700_understand_your_options_for_code_reuse.md","articles":[]},"previous":{"title":"Make Tests Easy To Understand","level":"1.5.5","depth":2,"path":"tests/500_make_tests_easy_to_understand.md","ref":"tests/500_make_tests_easy_to_understand.md","articles":[]},"dir":"ltr"},"config":{"gitbook":"*","theme":"default","variables":{},"plugins":["edit-link","etoc","anchors","expandable-chapters","pygments"],"pluginsConfig":{"etoc":{"mindepth":3,"maxdepth":4,"header":1,"h2lb":3,"notoc":false},"search":{},"lunr":{"maxIndexSize":1000000,"ignoreSpecialCharacters":false},"fontsettings":{"theme":"white","family":"sans","size":2},"highlight":{},"pygments":{},"sharing":{"facebook":true,"twitter":true,"google":false,"weibo":false,"instapaper":false,"vk":false,"all":["facebook","google","twitter","weibo","instapaper"]},"edit-link":{"label":"Edit This Page","base":"https://github.com/egis/JavaForSmallTeams/blob/master/"},"theme-default":{"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"},"showLevel":false},"anchors":{},"expandable-chapters":{}},"structure":{"langs":"LANGS.md","readme":"README.md","glossary":"GLOSSARY.md","summary":"SUMMARY.md"},"pdf":{"pageNumbers":true,"fontSize":12,"fontFamily":"Arial","paperSize":"a4","chapterMark":"pagebreak","pageBreaksBefore":"/","margin":{"right":62,"left":62,"top":56,"bottom":56}},"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"}},"file":{"path":"tests/600_understand_how_to_use_mocks_and_stubs.md","mtime":"2017-09-07T14:08:43.193Z","type":"markdown"},"gitbook":{"version":"3.2.3","time":"2017-09-07T14:10:24.125Z"},"basePath":"..","book":{"language":""}});
        });
    </script>
</div>

        
    <script src="../gitbook/gitbook.js"></script>
    <script src="../gitbook/theme.js"></script>
    
        
        <script src="../gitbook/gitbook-plugin-edit-link/plugin.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-etoc/plugin.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-expandable-chapters/expandable-chapters.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-search/search-engine.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-search/search.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-lunr/lunr.min.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-lunr/search-lunr.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-sharing/buttons.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-fontsettings/fontsettings.js"></script>
        
    

    </body>
</html>

